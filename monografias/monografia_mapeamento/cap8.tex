%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%   Aplicação do ambiente virtual com um agente autônomo
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Aplicação com ambiente virtual e agente autônomo}
\label{cap:aplicacao_autonomo}
A fim de produzir uma prova de conceito, foi implementada uma aplicação onde foi possível demonstrar a eficiência do algoritmo de mapeamento. Foi produzido um simulador com gravidade, colisão, rederização de texturas, objetos e atores (o agente nesse caso) e, tendo esse simulador como base, foi criada a aplicação que tem um agente utilizando-se do Toolkit Hórus para mapeamento e navegação dentro do ambiente simulado.
\section{Simulador}
Um simulador é todo software (em nosso caso) que simula um comportamento de algum sistema. Deve ser capaz de reproduzir, de forma mais fiel possível, a realidade na qual ele tenta emular. No nosso caso foi desenvolvido um simulador de um ambiente, a fim de virtualizar um ambiente real.

O simulador desenvolvido foi tratado como uma aplicação a parte, pois não estava incluído no escopo do projeto, porém tendo em vista a necessidade de um simulador customizado para a realidade de um agente móvel (e na linguagem selecionada) o simulador foi incluido ao projeto. 

Alguns requisitos foram necessários para que o simulador fosse projetado. Alguns softwares que foram utilizados: \textit{Blender} e \textit{Panda3d}.
Como uma das linguagens utilizadas foi \textit{Python}, buscou-se ferramentas que fossem compatíveis (na verdade ambas são em \textit{Python}) com as linguagens utilizadas.

\subsection{Python}
Python é um linguagem orientada objetos de tipagem dinâmica, onde os tipos dos dados são atribuídos durante a interpretação do código dinamicamente e forte. O Python tem foco na produtividade com uma sitaxe legível e simples, bem como módulos auxiliares (grande maioria OpenSource) que garatem um excelente desempenho.

\subsection{Blender}
O Blender é um produto da Blender Fundation, que é open source e desenvolvido em Python para modelagem de objetos 3D que está disponível para vários sistemas operacionais sobre a licença GNU (\textit{General Public License}).

\subsection{Panda3D}

O \textit{Panda3D} é um produto da equipe de desenvolvimento da Walt Disney para renderização de jogos e ambientes virtuais em terceira dimensão. Estão sobre licença da \textit{BSD License} (com algumas modificações para adequação a realidade do projeto).

\section{Ambiente}

O ambiente em que o agente foi testado consiste em uma área que simula um galpão com 5 cômodos onde o agente inicia sua movimentação no cômodo 1 e pode alcançar qualquer ponto do ambiente a partir de sua posição inicial. O ambiente que foi desenvolvido tem como objetivo emular, em menor escala, um ambiente real.

\begin{figure}[!htb]
\centering
\begin{center}
    \includegraphics[scale=0.3,bb=0 0 700 560]{imagens/fotos/robot.png}
\end{center}
\caption{O agente utilizado nos testes. Modelado em \textit{Blende3D}.}
\label{fig:agente}
\end{figure}

O agente utilizado foi inspirado no personagem de um filme que também é um agente inteligente, é possível notar a semelhança na figura \ref{fig:agente}.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.3,bb=0 0 390 550]{imagens/fotos/galpao.png}
\caption{O ambiente utilizado para a prova de conceito. Modelada em Blende3D.}
\label{fig:ambiente_blender}
\end{figure}

A figura \ref{fig:ambiente_blender}, que demonstra o ambiente que foi utilizado, pode-se ter uma visão em perspectiva do ambiente modelado. Ele foi modelado em Blender, tal ferramenta proporcionou os recursos de modelagem UV, texturização, determinação de medidas precisas, entre outros. O Blender foi selecionado, também, por conta da sua legibilidade de fácil assimilação tendo em vista que o \textit{Toolkit} foi desenvolvido em \textit{Python} e a ferramenta utiliza a mesma linguagem para produzir os modelos.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.3,bb=0 0 830 560]{imagens/fotos/colisions.png}
\caption{Os lasers projetados a partir do agente. Gerenciados pelo \textit{Panda3D}.}
\label{fig:ambiente_panda}
\end{figure}

O Panda3d foi utilizado para fazer todos os tratamentos de colisão e virtualização de camêras e renderização do agente no ambiente. Os lasers, áreas de colisão são tratados conforme a imagem \ref{fig:ambiente_panda} Como o Blender3D agilizou o processo o fato do \textit{Panda3D} ser em \textit{Python}.

\section{O mapeamento}

No que diz respeito ao mapeamento foram utilizadas algumas técnicas a fim de testar o desempenho do agente no ambiente proposto. 
\subsection{\textit{Mark Points}}

\textit{Mark Points} (pontos de marcos, ou simplesmente marcos) são circunferências criadas durante a navegação do agente. O algoritmo que gera os mark points é uma nova proposta apresentada pelo corrente trabalho para resolver o problema de mapeamento.

Em contrapartida ao \textit{SPIKE} e ao \textit{RANSAC} que buscam extrair landmarks utilizando-se das colisões dos lasers e esperando que essas colisões atendam a um requisito, no caso do \textit{RANSAC} espera-se a formação de uma linha, no caso do \textit{SPIKE} espera-se uma diferença muito grande entre um marco e outro, o processo de criação de mark points leva em consideração que todas as colisões dos lasers são landmarks, mas nem todos são armazenados.

O \textit{landmark} escolhido é denominado \textit{mark point}  e é aquele que não esteja em um ponto por onde o agente já passou.
Essa identificação é feita a partir do método de criação de mark points que nesse trabalho é chamado \textit{tryAMarkPoint} [colocar referencia para o apêndice].

O algoritmo do tryAMarkPoint é o seguinte:

\begin{table}[htb]
\centering         
	\begin{algorithmic}                
		\STATE $tryAMarkPoint(tuple posicao\textunderscore robo, float rotacao\textunderscore  robo$)
		\FORALL{$cada$ $mark\textunderscore point$ $em$ $lista\textunderscore mark\textunderscore poin$} 
			\STATE $RESULTADO$ $\leftarrow$ $isPointInCircle( mark\textunderscore point, posicao\textunderscore robo, raio\textunderscore circunferencia$)
			\IF{RESULTADO é \textit{FALSO}} 
				\STATE ADIOCIONAR $\leftarrow$ \textit{VERDADEIRO}
			\ELSE
				\STATE TENTATIVAS $\leftarrow$ TENTATIVAS - 1
			\ENDIF
		\ENDFOR
		\IF{ADICIONAR é \textit{VERDADEIRO}}
			\STATE  TENTATIVAS $\leftarrow$ TENTATIVAS + 2
			\STATE  Adiciona a posição do robô à lista de Mark Points  
		\ENDIF
		\RETURN $TENTATIVAS$
	\end{algorithmic}
\caption{Algoritmo tryAMarkPoint}
\end{table}
 
NOTA: \textit{isPointInCircle} é um método criado no módulo matemático responsável por identificar se um determinado ponto está ou não presente em um círculo de raio N. Os \textit{mark points} nada mais são do que círculos criados com raio N e centro na posição do agente no momento da descoberta do \textit{mark point}.
 
O método retorna o número de tentativas para se criar mark points. A aplicação que usa o método deve verificar a condição de parada do agente utilizando esse número de tentativas.

Este é um conceito de punição e recompensa, ou seja, se o agente encontra um novo \textit{mark point}, que significa um ponto ainda não explorado, então ele é recompensando com créditos, caso ele passe por um ponto já explorado ele é punido com a perda de créditos. No nosso trabalho, o agente mapeia o ambiente enquanto busca sempre encontrar novos \textit{mark points}, ou seja, busca sempre aumentar os seus créditos e pára de mapear quando esses créditos assumem um valor negativo ou zero, o que significa que não há mais pontos a serem descobertos (mapeamento completo).
